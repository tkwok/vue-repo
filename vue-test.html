<!doctype html>

<script src="https://unpkg.com/vue/dist/vue.js"></script>

<style>
  .input-container-parent {
    width: 13%;
  }

  .input-container {
    border: 1px solid #eaeaea;
    border-radius: 4px;
    width: 100%;
    padding: 10px;
    cursor: pointer;
    height: 36px;
  }

  .input-container, .input-container input {
    font-family: "Source Sans Pro", sans-serif;
    font-size: 16px;
  }

  .input-container .title {
    color: #eaeaea;
    display: block;
  }

  .input-container input {
    width: 100%;
    border: 0;
  }

  .input-container input:focus {
    outline: none;
  }

  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
</style>

<div id="app">
  <some-input v-model="selected" :options="[
    { value: 1, name: 'United States' },
    { value: 2, name: 'China' },
  ]" v-on:changed="eventChanged"></some-input>
  <h6>{{ selected }}</h6>
  <div class="input-container-parent">
    <calculator-numeric-input
      v-model="benefits.commute" label="Rent" @click="toggleView()"
      placeholder="Rent"></calculator-numeric-input>
  </div>
  <h6>{{ benefits.commute }}</h6>
  <div class="input-container-parent">
    <calculator-numeric-input v-model="benefits.meals" label="Transportation" placeholder="Transportation"></calculator-numeric-input>
  </div>
  <h6>{{ benefits.meals }}</h6>
</div>


<script>
  const someInput = {
    props: {
      options: { type: Array, default: () => [] },
      value: { default: null }
    },
    methods: {
      update: function(value) {
        this.$emit('changed', value);
      }
    },
    template: `
      <select @change="update($event.target.value) ">
        <option v-for='item of options' :value='item.value'>{{item.name}}</option>
      </select>`
  };
//<input type="number" :value="value" @input="$emit('input', $event.target.value)" />
  const calculatorNumericInput = {
    props: {
      label: { type: String, required: true },
      value: { default: null }
    },
    data: function() {
      return {
        showEditView: false
      }
    },
    directives: {
      clickOutside: {
        bind: function(el, binding, vnode) {
          handleOutsideClick = (e) => {
            e.stopPropagation();
            const { handler } = binding.value;
            let clickedOnExcludedEl = false;
            
            if (!el.contains(e.target)) {
              vnode.context[handler]();
            }
          }
          document.addEventListener('click', handleOutsideClick);
          document.addEventListener('touchstart', handleOutsideClick);
        },
        unbind: function() {
          document.removeEventListener('click', handleOutsideClick);
          document.removeEventListener('touchstart', handleOutsideClick);
        }
      }
    },
    methods: {
      toggleView: function() {
        console.log('wwwwww');
        if (this.showEditView) this.showEditView = !this.showEditView;
      }
    },
    template: `
        <div class="input-container" @click="toggleView" v-click-outside="{ handler: 'toggleView' }">
          <span v-if="!showEditView">
            <span class="title">
              {{ label }}
            </span>
            <span class="value">
              {{ value }}
            </span>
          </span>
          <span v-if="showEditView">
            <input type="number" :value="value" @input="$emit('input', $event.target.value)" />
          </span>
        </div>`
  };

  new Vue({
    el: '#app',
    components: {
      'some-input': someInput,
      'calculator-numeric-input': calculatorNumericInput
    },
    data: function() {
      return {
        selected: null,
        benefits: {
          commute: null,
          meals: null
        },
        selected: this.value,
        countries: ['china', 'ameria', 'taiwan']
      };
    },
    methods: {
      eventChanged: function(value) {
        console.log('changed from child', value);
      },
      onChange: function(event) {
        console.log(event.target.value);
      },
      updateCoachStatus: function(){
        this.benefits.commute = 200;
        this.benefits.meals = 400;
      },
      inputListeners: function () {
        var vm = this;
        return Object.assign({},
        this.$listeners, {
            input: function (event) {
              this.benefits.commute *= 5;
              vm.$emit('input', event.target.value);
            }
        });
      }
    },
    mounted: function () {
      this.updateCoachStatus();
    }
  });
</script>
