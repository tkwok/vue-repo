<!doctype html>

<script src="https://unpkg.com/vue/dist/vue.js"></script>

<style>
  .input-container-parent {
    width: 13%;
  }

  .input-container {
    border: 1px solid #eaeaea;
    border-radius: 4px;
    width: 100%;
    padding: 10px;
    cursor: pointer;
    height: 36px;
    position: relative;
  }

  .input-container, .input-container .input-element {
    font-family: "Source Sans Pro", sans-serif;
    font-size: 16px;
    color: #333;
  }

  .input-container .title {
    color: #aaa;
    display: block;
    font-size: 13px;
    padding-bottom: 5px;
  }

  .input-container .input-element {
    border: 0;
    position: absolute;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
  }

  .input-container .input-element::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
    color: #aaa;
    opacity: 1; /* Firefox */
  }

  .input-container .input-element:-ms-input-placeholder { /* Internet Explorer 10-11 */
    color: #aaa;
  }

  .input-container .input-element::-ms-input-placeholder { /* Microsoft Edge */
    color: #aaa;
  }

  .input-container .input-element:focus {
    outline: none;
  }

  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .fade-enter-active, .fade-leave-active {
    transition: opacity .1s;
  }

  .fade-enter, .fade-leave-to {
    opacity: 0;
  }

</style>

<div id="app">
  <some-input v-model="selected" :options="[
    { value: 0.5, name: 'United States' },
    { value: 200, name: 'China' }]"
    v-on:changed="eventChanged">
  </some-input>
  <h6>{{ selected }}</h6>

  <div class="input-container-parent">
    <calculator-numeric-input
      v-model="benefits.commute"
      label="Rent"
      @click="toggleView()"
      placeholder="Rent">
    </calculator-numeric-input>
  </div>
  <h6>{{ benefits.commute }}</h6>

  <div class="input-container-parent">
    <calculator-numeric-input v-model="benefits.meals"
      label="Transportation"
      @click="toggleView()"
      placeholder="Transportation">
    </calculator-numeric-input>
  </div>
  <h6>{{ benefits.meals }}</h6>

  <div class="input-container-parent">
    <calculator-numeric-input v-model="benefits.hotels"
      label="Hotels"
      @click="toggleView()"
      placeholder="Hotels">
    </calculator-numeric-input>
  </div>
  <h6>{{ benefits.hotels }}</h6>
</div>


<script>
  const someInput = {
    props: {
      options: { type: Array, default: () => [] },
      value: { default: null }
    },
    methods: {
      update: function(value) {
        this.$emit('changed', value);
      }
    },
    template: `
      <select @change="update($event.target.value) ">
        <option v-for='item of options' :value='item.value'>{{item.name}}</option>
      </select>`
  };
//<input type="number" :value="value" @input="$emit('input', $event.target.value)" />
  const calculatorNumericInput = {
    props: {
      label: { type: String, required: true },
      value: { required: false }
    },
    data: function() {
      return {
        showEditView: false
      }
    },
    directives: {
      'click-outside': {
        bind: function(el, binding) {
          if (typeof binding.value === 'function') {
            const handler = (event) => {
              if (binding.modifiers.bubble || -1 == event.path.indexOf(el)) {
              	binding.value(event);
              }
            };
            el.__vueClickOutside__ = handler;
            document.addEventListener('click', handler);
          }
        },
        unbind: function() {
          document.removeEventListener('click', el.__vueClickOutside__);
          el.__vueClickOutside__ = null;
        }
      }
    },
    methods: {
      toggleView: function(event) {
        this.showEditView = !this.showEditView;
        if (this.showEditView) {
          this.$nextTick(() => {
            this.$refs.inputValue.focus();
          });
        } else {

        }

      },
      toggleOutsideView: function(event) {
        this.showEditView = false;
      }
    },

    template: `
      <div class="input-container" @click="toggleView" v-click-outside="toggleOutsideView">
        <transition name="fade">
          <span class="title" v-if="!showEditView">
            {{ label }}
          </span>
        </transition>

        <transition name="fade">
          <span class="value" v-if="!showEditView">
            {{ value }}
          </span>
        </transition>

        <span v-if="showEditView">
          <input class="input-element" type="number" ref="inputValue" placeholder="Hotels" v-model="value" @input="$emit('input', $event.target.value)" />
        </span>

      </div>`
  };

  new Vue({
    el: '#app',
    components: {
      'some-input': someInput,
      'calculator-numeric-input': calculatorNumericInput
    },
    data: function() {
      return {
        selected: null,
        benefits: {
          commute: null,
          meals: null
        },
        selected: this.value,
        countries: ['china', 'ameria', 'taiwan']
      };
    },
    methods: {
      eventChanged: function(value) {
        this.benefits.commute *= value;
      },
      onChange: function(event) {
        console.log(event.target.value);
      },
      updateCoachStatus: function(){
        this.benefits.commute = 200;
        this.benefits.meals = 400;
      },
      inputListeners: function () {
        var vm = this;
        return Object.assign({},
        this.$listeners, {
          input: function (event) {
            this.benefits.commute *= 5;
            vm.$emit('input', event.target.value);
          }
        });
      },
      setFocus: function() {
        this.$refs.search.focus();
      }
    },
    mounted: function () {
      this.updateCoachStatus();
    }
  });
</script>
